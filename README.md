# BM

![birch](./assets/birch-296x328.png)

[Stack-Based](https://en.wikipedia.org/wiki/Stack-oriented_programming) Language with Powerful Meta-Programming.

## Build

We are using [nobuild](https://github.com/tsoding/nobuild) build system which requires a bootstrapping step with any relatively standard complaint C compiler.

On Linux/MacOS/FreeBSD/literally any OS on the planet Earth except Windows with MSVC:

```console
$ cc -o nobuild nobuild.c
$ ./nobuild help
```

If you still want to use MSVC on Windows run [vcvarsall.bat](https://docs.microsoft.com/en-us/cpp/build/building-on-the-command-line?view=msvc-160) and from within the development environment of MSVC:

```console
> cl.exe nobuild.c
> nobuild.exe help
```
### Building the libbm Library

```console
$ ./nobuild lib
```
The static library will be put into `./build/library/`

### Building the Toolchain

```console
$ ./nobuild tools
```

The binaries of the toolchain will be placed in `./build/toolchain/`.

### Building and Running Examples

```console
$ ./nobuild examples
```

The examples will be placed in `./build/examples/`.

To run the examples use [basm](#basm) executable from the [toolchain](#toolchain):

```
$ ./build/toolchain/bme ./build/examples/hello.bm
$ ./build/toolchain/bme ./build/examples/fib.bm
$ ./build/toolchain/bme ./build/examples/e.bm
$ ./build/toolchain/bme ./build/examples/pi.bm
```

#### Adding More Examples

`nobuild examples` automatically builds all the `./examples/*.basm` files. So if you want to add a new example to the build just add `*.basm` file to [./examples/](./examples/).

### Running and Recoding Tests

TBD

## Toolchain

### basm

Assembly language for the Virtual Machine. For examples see [./examples/](./examples) folder.

### bme

BM emulator. Used to run programs generated by [basm](#basm).

### bdb

BM debuger. Used to step debug programs generated by [basm](#basm).

### debasm

Disassembler for the binary files generated by [basm](#basm)

### bmr

BM recorder. Used to record the output of binary files generated by [basm](#basm) and comparing those output to the expected ones. We use this tool for Integration Testing.

### expr2dot

Accepts [BASM TTE](./docs/assembly.md#translation-time-expressions) as a command line argument and dumps its AST in [dot format](https://graphviz.org/doc/info/lang.html) that you can render later with [graphviz](https://graphviz.org/download/) later.

```console
$ ./build/toolchain/expr2dot "f(a) + g(b) + 69 > 420" | dot -Tsvg > ast.svg
$ iexplore.exe ast.svg
```

## Editor Support

### Emacs

Emacs mode available in [./tools/basm-mode.el](./tools/basm-mode.el). Until the language stabilized and we upload the mode on [MELPA](https://melpa.org/) you need to install this mode manually.

Add the following lines to your `.emacs` file:

```emacs-lisp
(add-to-list 'load-path "/path/to/basm-mode/")
(require 'basm-mode)
```

### Vim

Copy [./tools/basm.vim](./tools/basm.vim) in `.vim/syntax/basm.vim`. Add the following line to your `.vimrc` file:

```vimscript
autocmd BufRead,BufNewFile *.basm set filetype=basm
```

Urmom xD
